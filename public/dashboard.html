<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Swift Hub</title>
<meta name="viewport" content="width=device-width">

<style>

body{
  background:black;
  color:white;
  font-family:Orbitron,sans-serif;
  margin:0;
}

/* ================= HEADER ================= */

header{
  padding:12px;
  text-align:center;
  border-bottom:2px solid white;
  position:relative;
}

.menu,.back{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  font-size:22px;
  cursor:pointer;
}

.back{display:none}

/* Title Gradient */

h1{
  font-size:22px;
  background:linear-gradient(90deg,#fff,#ff0000,#fff);
  background-size:300%;
  -webkit-background-clip:text;
  color:transparent;
  animation:titleFlow 4s linear infinite;
}

@keyframes titleFlow{
  from{background-position:0%}
  to{background-position:300%}
}

/* ================= TABLE ================= */

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid white;
  padding:5px;
  text-align:center;
  font-size:11px;
  word-break:break-all;
}

/* ================= STATUS ================= */

.green{
  color:#00ff88;
  animation:blink 1s infinite;
  text-shadow:0 0 12px #00ff88;
}

.yellow{
  color:#ffe600;
  animation:blink 1s infinite;
  text-shadow:0 0 12px #ffe600;
}

.red{
  color:#ff3333;
  animation:blink 1s infinite;
  text-shadow:0 0 12px #ff3333;
}

@keyframes blink{
  0%{opacity:1}
  50%{opacity:.4}
  100%{opacity:1}
}

/* ================= PANEL ================= */

#panel{
  position:fixed;
  inset:0;
  background:black;
  display:none;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:15px;
  z-index:99;
}

.btn{
  border:1px solid white;
  padding:10px 20px;
  cursor:pointer;
  animation:panelBlink 1s infinite alternate;
}

@keyframes panelBlink{
  0%{box-shadow:0 0 5px #fff}
  100%{box-shadow:0 0 15px #fff}
}

/* ================= PAGES ================= */

#chartPage,
#dataPage{
  display:none;
  text-align:center;
  padding:10px;
}

/* ================= CANVAS ================= */

canvas{
  border:1px solid white;
  box-shadow:0 0 15px #fff;
}

</style>
</head>

<body>

<!-- MENU PANEL -->

<div id="panel">
  <div class="btn" onclick="openMain()">ğŸ“‹ Keys</div>
  <div class="btn" onclick="openData()">ğŸ“„ Data</div>
  <div class="btn" onclick="openChart()">ğŸ“Š Chart</div>
  <div class="btn" onclick="closePanel()">âŒ Close</div>
</div>

<header>

  <div class="menu" id="menuBtn" onclick="openPanel()">â˜°</div>
  <div class="back" id="backBtn" onclick="backHome()">â†</div>

  <h1>SWIFT HUB â€¢ KEY CONTROL</h1>

</header>

<!-- ================= MAIN ================= -->

<div id="main">

<table>
<thead>
<tr>
<th>#</th>
<th>User</th>
<th>Key</th>
<th>Status</th>
<th>Time</th>
</tr>
</thead>

<tbody id="data"></tbody>
</table>

</div>

<!-- ================= DATA PAGE ================= -->

<div id="dataPage">

<h3>ğŸ“„ User Data</h3>

<table>
<thead>
<tr>
<th>#</th>
<th>ğŸ‘¤ User</th>
<th>ğŸ†” UID</th>
<th>ğŸŒ IP</th>
<th>ğŸ’» HWID</th>
<th>ğŸ”‘ Key</th>
</tr>
</thead>

<tbody id="dataInfo"></tbody>
</table>

</div>

<!-- ================= CHART ================= -->

<div id="chartPage">

<h3>ğŸ“Š Usage Chart (%)</h3>

<canvas id="chart" width="320" height="220"></canvas>

<br><br>

<button onclick="download()">â¬‡ Download</button>

</div>

<script>

let cache=[];

/* ================= PANEL ================= */

function openPanel(){ panel.style.display="flex"; }
function closePanel(){ panel.style.display="none"; }

function openMain(){

  panel.style.display="none";

  main.style.display="block";
  dataPage.style.display="none";
  chartPage.style.display="none";

  menuBtn.style.display="block";
  backBtn.style.display="none";
}

function openData(){

  panel.style.display="none";

  main.style.display="none";
  dataPage.style.display="block";
  chartPage.style.display="none";

  menuBtn.style.display="none";
  backBtn.style.display="block";

  renderData();
}

function openChart(){

  panel.style.display="none";

  main.style.display="none";
  dataPage.style.display="none";
  chartPage.style.display="block";

  menuBtn.style.display="none";
  backBtn.style.display="block";

  draw();
}

function backHome(){

  main.style.display="block";
  dataPage.style.display="none";
  chartPage.style.display="none";

  menuBtn.style.display="block";
  backBtn.style.display="none";
}

/* ================= LOAD ================= */

async function load(){

  let r = await fetch("/api/dashboard");
  let d = await r.json();

  cache = d;

  let h="";

  d.forEach((k,i)=>{

    let st="",cls="",time="-";

    if(!k.used){

      st="ğŸŸ¢";
      cls="green";

    }else if(k.left>0){

      st="ğŸŸ¡";
      cls="yellow";

      time = format(k.left);

    }else{

      st="ğŸ”´";
      cls="red";
      time="EXPIRED";
    }

    h+=`
<tr>
<td>${i+1}</td>
<td>${k.user||"-"}</td>
<td>${k.key||"-"}</td>
<td class="${cls}">${st}</td>
<td>${time}</td>
</tr>`;
  });

  data.innerHTML=h;
}

/* ================= DATA PAGE ================= */

function renderData(){

  let h="";

  cache.forEach((k,i)=>{

    h+=`
<tr>
<td>${i+1}</td>
<td>${k.user||"-"}</td>
<td>${k.uid||"-"}</td>
<td>${k.ip||"-"}</td>
<td>${k.hwid||"-"}</td>
<td>${k.key||"-"}</td>
</tr>`;
  });

  dataInfo.innerHTML=h;
}

/* ================= TIME ================= */

function format(ms){

  let s=Math.floor(ms/1000);

  let h=Math.floor(s/3600);
  let m=Math.floor((s%3600)/60);
  let se=s%60;

  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}`;
}

/* ================= CHART ================= */

function draw(){

  let c=chart;
  let ctx=c.getContext("2d");

  ctx.clearRect(0,0,320,220);

  let total=cache.length;
  let used=cache.filter(x=>x.used).length;

  let p= total?Math.round(used/total*100):0;

  let color= p>50?"#00ff88":"#ff3333";

  ctx.strokeStyle=color;
  ctx.lineWidth=3;
  ctx.shadowBlur=20;
  ctx.shadowColor=color;

  ctx.beginPath();

  for(let i=0;i<12;i++){

    let v=p+Math.random()*12-6;

    if(v<5)v=5;
    if(v>100)v=100;

    let x=20+i*25;
    let y=200-v*1.7;

    if(i==0)ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }

  ctx.stroke();

  ctx.fillStyle="#fff";
  ctx.fillText(p+"%",260,25);
}

/* ================= DOWNLOAD ================= */

function download(){

  let a=document.createElement("a");

  a.href=chart.toDataURL("image/png");
  a.download="swift_hub_chart.png";

  a.click();
}

/* ================= START ================= */

load();
setInterval(load,2000);

</script>

</body>
</html>
