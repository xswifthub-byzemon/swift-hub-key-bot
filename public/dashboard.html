<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Swift Hub</title>
<meta name="viewport" content="width=device-width">

<style>

body{
  background:black;
  color:white;
  font-family:Orbitron;
  margin:0;
}

header{
  padding:12px;
  text-align:center;
  border-bottom:2px solid white;
  position:relative;
}

.menu,.back{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  font-size:22px;
  cursor:pointer;
}

.back{display:none}

h1{
  font-size:22px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid white;
  padding:5px;
  text-align:center;
  font-size:11px;
}

/* Status Colors */

.green{
  color:#00ff88;
  animation:blink 1s infinite;
  text-shadow:0 0 10px #00ff88;
}

.yellow{
  color:#ffe600;
  animation:blink 1s infinite;
  text-shadow:0 0 10px #ffe600;
}

.red{
  color:#ff3333;
  animation:blink 1s infinite;
  text-shadow:0 0 10px #ff3333;
}

@keyframes blink{
  0%{opacity:1}
  50%{opacity:.4}
  100%{opacity:1}
}

#panel{
  position:fixed;
  inset:0;
  background:black;
  display:none;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:15px;
}

.btn{
  border:1px solid white;
  padding:10px 20px;
  cursor:pointer;
}

#chartPage{
  display:none;
  text-align:center;
}

canvas{
  border:1px solid white;
}

</style>
</head>

<body>

<div id="panel">
  <div class="btn" onclick="openInfo()">üìÑ Data</div>
  <div class="btn" onclick="openChart()">üìä Chart</div>
  <div class="btn" onclick="closePanel()">‚ùå Close</div>
</div>

<header>

  <div class="menu" id="menuBtn" onclick="openPanel()">‚ò∞</div>
  <div class="back" id="backBtn" onclick="backHome()">‚Üê</div>

  <h1>SWIFT HUB CONTROL</h1>

</header>

<div id="main">

<table>
<thead>
<tr>
<th>#</th>
<th>User</th>
<th>UID</th>
<th>IP</th>
<th>HWID</th>
<th>Key</th>
<th>Status</th>
</tr>
</thead>

<tbody id="data"></tbody>
</table>

</div>

<div id="chartPage">

<h3>Usage Chart</h3>

<canvas id="chart" width="300" height="200"></canvas>

<br><br>

<button onclick="download()">‚¨á Download</button>

</div>

<script>

let cache=[];

function openPanel(){
  panel.style.display="flex";
}

function closePanel(){
  panel.style.display="none";
}

function openChart(){

  panel.style.display="none";
  main.style.display="none";
  chartPage.style.display="block";

  menuBtn.style.display="none";
  backBtn.style.display="block";

  draw();
}

function openInfo(){
  closePanel();
}

function backHome(){

  chartPage.style.display="none";
  main.style.display="block";

  menuBtn.style.display="block";
  backBtn.style.display="none";
}

// ================= Load =================

async function load(){

  let r = await fetch("/api/dashboard");
  let d = await r.json();

  cache = d;

  let h = "";

  d.forEach((k,i)=>{

    let st = "";
    let cls = "";

    /* ===== Status Logic ===== */

    if(!k.used){
      // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ
      st = "üü¢";
      cls = "green";

    }else if(k.left > 0){
      // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      st = "üü°";
      cls = "yellow";

    }else{
      // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
      st = "üî¥";
      cls = "red";
    }

    h += `
<tr>
<td>${i+1}</td>
<td>${k.user || "-"}</td>
<td>${k.uid || "-"}</td>
<td>${k.ip || "-"}</td>
<td>${k.hwid || "-"}</td>
<td>${k.key || "-"}</td>
<td class="${cls}">${st}</td>
</tr>`;
  });

  data.innerHTML = h;
}

// ================= Chart =================

function draw(){

  let c = document.getElementById("chart");
  let ctx = c.getContext("2d");

  ctx.clearRect(0,0,300,200);

  let total = cache.length;
  let used = cache.filter(x=>x.used).length;

  let p = total ? Math.round(used/total*100) : 0;

  let color = p>50 ? "#00ff88" : "#ff3333";

  ctx.strokeStyle = color;
  ctx.lineWidth = 3;

  ctx.shadowBlur = 15;
  ctx.shadowColor = color;

  ctx.beginPath();

  for(let i=0;i<12;i++){

    let v = p + Math.random()*10 - 5;

    let x = 20 + i*22;
    let y = 180 - v*1.5;

    if(i==0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }

  ctx.stroke();
}

// ================= Download =================

function download(){

  let a = document.createElement("a");

  a.href = chart.toDataURL("image/png");
  a.download = "chart.png";

  a.click();
}

// ================= Start =================

load();
setInterval(load,2000);

</script>

</body>
</html>
